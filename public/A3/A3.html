<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çœŸæ­¦æ±¤Â·é™„å­å¥‡ç¼˜</title>
    <link rel="stylesheet" href="A3.css"></link>
</head>
<body>
    <!-- Audio for page load -->
    <audio id="intro-voice" src="../../assets/voice/voice7.mp3" preload="auto"></audio>

    <!-- Level Name -->
    <div class="location-name">å…³å¡ä¸‰.å‰‚é‡ä¹‹è¡¡</div>
    <!-- Location Name -->
    <!-- <div class="location-name">è¯ç§¤å°</div> -->

    <!-- Master's Question -->
    <div class="question-dialog" id="question-dialog">
        <div class="dialog-content">
            <p>â€œé™„å­ä¹‹åŠ›ï¼Œè´µåœ¨å‰‚é‡å¾—å®œã€‚è¿‡åˆ™ç”Ÿæ¯’ï¼Œä¸åŠåˆ™æ— åŠŸã€‚çœŸæ­¦æ±¤ä¸­ï¼Œé™„å­å¸¸ç”¨å‡ ä½•ï¼Ÿâ€ï¼ˆçœŸæ­¦æ±¤ä¸´åºŠå¸¸ç”¨çš„é™„å­å‰‚é‡å¤šå¤§ï¼‰</p>
        </div>
    </div>

    <!-- Scale Instruction -->
    <div class="scale-instruction">
        <div class="arrow-down"></div>
        <div class="instruction-text">è¯·ç‚¹å‡»æ†ç§¤ï¼Œè°ƒæ•´æ†ç§¤çš„åˆ»åº¦ï¼Œå›ç­”å¸ˆçˆ¶çš„é—®é¢˜</div>
    </div>
    
    <!-- Scale Click Area -->
    <div class="scale-click-area" onclick="showScalePopup()"></div>

    <!-- Scale Popup -->
    <div class="popup-overlay" id="scale-popup" style="display: none;" onclick="hideScalePopup()">
        <div class="popup-content scale-content" onclick="event.stopPropagation()">
            <div class="close-btn" onclick="hideScalePopup()">Ã—</div>
            <h2>è¯·æ‹–åŠ¨æ»‘å—é€‰æ‹©é™„å­å‰‚é‡</h2>
            <div class="slider-container">
                <div class="ruler-marks">
                    <!-- 3 main ticks for the intervals -->
                    <div class="mark" style="left: 0%;"></div>
                    <div class="mark" style="left: 50%;"></div>
                    <div class="mark" style="left: 100%;"></div>
                </div>
                <div class="ruler-numbers">
                    <span style="left: 0%; transform: translateX(0);">å°äº3g</span>
                    <span style="left: 50%;">3~15g</span>
                    <span style="left: 100%; transform: translateX(-100%);">å¤§äº15g</span>
                </div>
                <!-- min=0, max=2, step=1 for 3 intervals -->
                <input type="range" min="0" max="2" step="1" value="0" class="slider" id="doseSlider" oninput="updateDoseValue(this.value)">
                <div class="dose-display"><span id="doseValue">å°äº3g</span></div>
            </div>
            
            <button class="confirm-btn" onclick="checkDose()">ç¡® å®š</button>
        </div>
    </div>

    <!-- Right Toolbar -->
    <div class="game-toolbar">
        <div class="tool-item" onclick="showBook()" title="æŸ¥çœ‹ç»æ–‡">
            ğŸ“–
        </div>
        <div class="tool-item" onclick="showHint()" title="æŸ¥çœ‹æç¤º">
            ğŸ”
        </div>
    </div>

    <!-- Next Level Button -->
    <button class="next-level-btn" id="next-level-btn" onclick="goToNextLevel()">ä¸‹ä¸€å…³</button>

    <!-- Book Popup -->
    <div class="popup-overlay" id="book-popup" style="display: none;" onclick="hideBook()">
        <div class="popup-content book-style" onclick="event.stopPropagation()">
            <div class="close-btn" onclick="hideBook()">Ã—</div>
            <div class="book-pages">
                <!-- Page 1: Scripture -->
                <div class="book-page" id="book-page-1">
                    <div class="book-text">
                        <p>â€œå¤ªé˜³ç—…ï¼Œå‘æ±—ï¼Œæ±—å‡ºä¸è§£ï¼Œå…¶äººä»å‘çƒ­ï¼Œå¿ƒä¸‹æ‚¸ï¼Œå¤´çœ©ï¼Œèº«ç¤åŠ¨ï¼ŒæŒ¯æŒ¯æ¬²æ“—åœ°è€…ï¼Œ<span class="highlight-red">çœŸæ­¦æ±¤</span>ä¸»ä¹‹ã€‚â€</p>
                        <p>â€œå°‘é˜´ç—…ï¼ŒäºŒä¸‰æ—¥ä¸å·²ï¼Œè‡³å››äº”æ—¥ï¼Œè…¹ç—›ï¼Œå°ä¾¿ä¸åˆ©ï¼Œå››è‚¢æ²‰é‡ç–¼ç—›ï¼Œè‡ªä¸‹åˆ©è€…ï¼Œæ­¤ä¸ºæœ‰æ°´æ°”ã€‚å…¶äººæˆ–å’³ï¼Œæˆ–å°ä¾¿åˆ©ï¼Œæˆ–ä¸‹åˆ©ï¼Œæˆ–å‘•è€…ï¼Œ<span class="highlight-red">çœŸæ­¦æ±¤</span>ä¸»ä¹‹ã€‚â€</p>
                    </div>
                </div>
                <!-- Page 2: A1 Content -->
                <div class="book-page" id="book-page-2" style="display: none;">
                    <div class="book-text">
                        <p>ç”Ÿé™„å­ï¼Œå‘ˆä¹Œé»‘ä¹‹è‰²ï¼Œå¸¦ç€ç²—ç³™çš„å¤–çš®ï¼Œå½¢çŠ¶ä¸è§„åˆ™ï¼Œå‡‘è¿‘èƒ½é—»åˆ°ä¸€è‚¡è½»å¾®çš„è¾›è¾£è…¥æ°”ï¼›ç†Ÿé™„å­ï¼Œæ˜¯é»„ç™½è‰²çš„åˆ‡ç‰‡ï¼Œè´¨åœ°æ¸©æ¶¦ï¼Œè¡¨é¢å…‰æ»‘ï¼Œæ•£å‘ç€æ·¡æ·¡çš„è¯é¦™ã€‚</p>
                        <p>ç”Ÿé™„å­æ¯’æ€§çŒ›çƒˆï¼Œå¤šç”¨äºå›é˜³æ•‘é€†ä¹‹æ€¥æ•‘ï¼Œä¸åˆé€‚çœŸæ­¦æ±¤ã€‚ç†Ÿé™„å­ç»ç‚®åˆ¶ï¼Œæ¯’æ€§å¤§å‡ï¼Œè¯æ€§æ¸©ç…¦æŒä¹…ï¼Œæ­£åˆçœŸæ­¦æ±¤æ¸©é˜³åˆ©æ°´ä¹‹éœ€ã€‚</p>
                    </div>
                </div>
                <!-- Page 3: A2 Content -->
                <div class="book-page" id="book-page-3" style="display: none;">
                    <div class="book-text">
                        <p>ç”Ÿé™„å­å›é˜³æ•‘é€†ï¼Œç†Ÿé™„å­æ¸©è¡¥å‘½é—¨ï¼ŒäºŒè€…å„æœ‰æ‰€é•¿</p>
                    </div>
                </div>
                <!-- Page 4: A3 Content -->
                <div class="book-page" id="book-page-4" style="display: none;">
                    <div class="book-text">
                        <p>é™„å­3gä»¥ä¸‹æéš¾å¥æ•ˆï¼Œ15gä»¥ä¸Šé£é™©é™¡å¢ï¼Œéç»éªŒä¸°å¯Œè€…ä¸å¯è½»ç”¨ã€‚çº¦åˆä»Šä¹‹3è‡³15å…‹ã€‚</p>
                        <p>ç‚®åˆ¶å¾—æ³•ï¼Œå‰‚é‡é€‚ä¸­ï¼Œæ–¹èƒ½å›é˜³æ•‘é€†è€Œä¸ä¼¤æ­£ã€‚ç„¶éœ€è°¨è®°ï¼Œå…·ä½“ç”¨é‡é¡»éµåŒ»å˜±ï¼Œå› äººã€å› è¯è€Œå¼‚ã€‚</p>
                    </div>
                </div>
            </div>
            <!-- Pagination Controls -->
            <div class="book-pagination" id="book-pagination" style="display: flex;">
                <button class="page-btn" id="prev-btn" onclick="changePage(-1)" disabled>ä¸Šä¸€é¡µ</button>
                <span class="page-indicator" id="page-indicator">1 / 4</span>
                <button class="page-btn" id="next-btn" onclick="changePage(1)">ä¸‹ä¸€é¡µ</button>
            </div>
        </div>
    </div>

    <script>
        // Play audio on load
        window.addEventListener('load', function() {
            const audio = document.getElementById('intro-voice');
            if(audio) {
                audio.play().catch(function(error) {
                    console.log("Autoplay prevented:", error);
                    // If autoplay is blocked, play on first user interaction
                    document.body.addEventListener('click', function() {
                        audio.play();
                    }, { once: true });
                });
            }
        });

        let currentPage = 1;
        let totalPages = 4;

        function showBook() {
            document.getElementById('book-popup').style.display = 'flex';
        }

        function hideBook() {
            document.getElementById('book-popup').style.display = 'none';
        }

        function changePage(direction) {
            const newPage = currentPage + direction;
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                updatePagination();
            }
        }

        function updatePagination() {
            document.querySelectorAll('.book-page').forEach(page => page.style.display = 'none');
            document.getElementById(`book-page-${currentPage}`).style.display = 'block';
            document.getElementById('page-indicator').textContent = `${currentPage} / ${totalPages}`;
            document.getElementById('prev-btn').disabled = currentPage === 1;
            document.getElementById('next-btn').disabled = currentPage === totalPages;
        }

        function showHint() {
            alert("æç¤ºï¼šå›é¡¾å¸ˆçˆ¶çš„æ•™è¯²ã€‚");
        }

        function showScalePopup() {
            document.getElementById('scale-popup').style.display = 'flex';
            // Hide instruction when clicked
            document.querySelector('.scale-instruction').style.display = 'none';
            // Initialize dose display position and calculation
            const slider = document.getElementById('doseSlider');
            if(slider) {
                updateDoseValue(slider.value);
            }
        }

        function hideScalePopup() {
            document.getElementById('scale-popup').style.display = 'none';
        }
        
        function updateDoseValue(val) {
            updateTotalCalculation();
        }

        function updateTotalCalculation() {
            const sliderVal = parseInt(document.getElementById('doseSlider').value);
            // sliderVal: 0 -> <3g, 1 -> 3-15g, 2 -> >15g
            
            let text = "";
            let percent = 0;
            
            if (sliderVal === 0) {
                text = "å°äº3g";
                percent = 0; // Match tick position
            } else if (sliderVal === 1) {
                text = "3~15g";
                percent = 50;
            } else {
                text = "å¤§äº15g";
                percent = 100;
            }

            // Update Text
            const displayEl = document.getElementById('doseValue');
            if(displayEl) {
                displayEl.textContent = text;
            }

            // Update Bubble Position based on PERCENT
            const bubble = document.querySelector('.dose-display');
            if(bubble) {
                // The bubble has transform: translateX(-50%) in CSS
                // So setting left to the percentage centers it over that point
                bubble.style.left = `${percent}%`;
                bubble.style.backgroundColor = "#2c1810";
                bubble.title = "";
            }
        }

        function checkDose() {
            const sliderVal = parseInt(document.getElementById('doseSlider').value);
            
            const dialogContent = document.querySelector('#question-dialog .dialog-content p');
            const instructionEl = document.querySelector('.scale-instruction');
            const instructionText = document.querySelector('.instruction-text');
            
            // 0: <3g, 1: 3-15g (Correct), 2: >15g
            if (sliderVal === 1) {
                // Correct range (Medium)
                dialogContent.textContent = "â€œå–„ï¼æ­¤ä¹ƒå®‰å…¨æœ‰æ•ˆä¹‹èŒƒå›´ï¼Œçº¦åˆä»Šä¹‹3è‡³15å…‹ã€‚ç‚®åˆ¶å¾—æ³•ï¼Œå‰‚é‡é€‚ä¸­ï¼Œæ–¹èƒ½å›é˜³æ•‘é€†è€Œä¸ä¼¤æ­£ã€‚ç„¶éœ€è°¨è®°ï¼Œå…·ä½“ç”¨é‡é¡»éµåŒ»å˜±ï¼Œå› äººã€å› è¯è€Œå¼‚ã€‚â€";
                hideScalePopup();
                // Show next level button
                document.getElementById('next-level-btn').style.display = 'block';
            } else {
                let msg = "";
                let currentRange = "";
                
                if (sliderVal === 0) {
                    msg = "â€œå‰‚é‡è¿‡è½»ï¼3gä»¥ä¸‹æéš¾å¥æ•ˆï¼Œéš¾ä»¥å›é˜³æ•‘é€†ã€‚â€";
                    currentRange = "å°äº3g";
                } else { // sliderVal === 2
                    msg = "â€œå‰‚é‡è¿‡é‡ï¼15gä»¥ä¸Šé£é™©é™¡å¢ï¼Œéç»éªŒä¸°å¯Œè€…ä¸å¯è½»ç”¨ã€‚â€";
                    currentRange = "å¤§äº15g";
                }
                
                dialogContent.textContent = `${msg} å½“å‰é€‰æ‹©${currentRange}ï¼Œå¸¸è§„åº”åœ¨3-15gä¹‹é—´è°¨æ…è°ƒæ•´ã€‚`;
                hideScalePopup();
                
                // Show instruction again with error message
                if(instructionEl && instructionText) {
                    instructionEl.style.display = 'flex';
                    instructionText.textContent = "å‰‚é‡ä¸å½“ï¼Œè¯·è°ƒæ•´";
                }
            }
        }

        function goToNextLevel() {
            window.location.href = '../A4/A4.html';
        }
    </script>
    <a class="back-btn" href="../A2/A2.html">è¿”å›ä¸Šä¸€å…³</a>
</body>
</html>
